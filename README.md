# Cangjie API Public Repository

## Introduction

The Cangjie API Public Repository is used to store and manage the public API declarations of each Cangjie subsystem. It also provides corresponding SDK building tools to support the construction of Cangjie API in the OpenHarmony SDK.

Currently, the Cangjie API only supports standard devices.

## System Architecture

**Figure 1** System architecture of interface_sdk_cangjie

![](figures/interface_sdk_cangjie_architecture.png)

As shown in the architecture diagram:

- API Declaration: Cangjie API declaration files (xxx.cj.d), mainly including ohos modules and Cangjie standard library related API declaration files, stored in directories according to Kit ownership.
- Kit Declaration: Unified external declaration files of Cangjie kit modules.
- build-tools: SDK building toolset, such as cjo generation tools, mock API library tools, etc.
  - cjo generation toolchain: Including cjo deserialization files (xxx.cjo.json) of each Cangjie API module, FlatBuffers Schema files, and related build scripts. Mainly used during SDK building to quickly serialize xxx.cjo.json into cjo of each Cangjie API module through the flatc tool. For detailed introduction to Cangjie cjo and serialization/deserialization build process, please refer to [Cangjie cjo](https://gitcode.com/Cangjie/cangjie_docs/blob/08234c9e52cd55a6f1a2521c65f39745fa6d64a3/docs/dev-guide/source_en/Appendix/cjo_artifacts.md) and [Cangjie cjo build](build-tools/cjo/README.md).
  - mock API library tool: Contains an empty implementation ohos.mock module and related build scripts. During SDK building, the ohos.mock dynamic library is used as a copy object to generate empty implementation dynamic libraries for each Cangjie API module.

Dependencies introduction in the architecture diagram:

- cangjie_ark_interop: The macro package in Cangjie SDK depends on the Cangjie-ArkTS interoperability interface repository to build interoperability macros.
- arkui_cangjie_wrapper: The macro package in Cangjie SDK depends on the ArkUI development framework Cangjie interface repository to build state management macros.

Code directory structure:
```
interface/sdk_cangjie
├── api
│   └── xxxKit                   # Specific Kit name, such as Cangjie, BasicServiceKit, etc.
│       └── xxx.cj.d             # Specific module interface files of each kit, storage path is subject to the actual file list of the kit
├── kits                         # Unified external declaration files of each kit
│   └── xxx.cj.d
├── build-tools                  # SDK building tools
│   ├── cjo                      # Tools related to cjo building
│   ├── lib
│   │   └── mock                 # Scripts related to mock API library                      
│   └── script                   # Scripts related to SDK building
├── figures                      # README images
├── LICENSE
└── bundle.json
```

## Delivery View

**Figure 2** Cangjie SDK delivery view
![](figures/interface_sdk_cangjie_delivery_view.png)

**ohos-sdk:**

- OpenHarmony SDK currently consists of js, ets, native, toolchains, previewer, and cangjie components. This repository mainly involves the cangjie part building.

**api:**

 - lib package currently only supports ohos-related cross-compilation packages, storing empty implementation Cangjie API dynamic libraries generated by the mock API tool and Cangjie cjo serialized by the flatc tool.
   - ohos-aarch64: For cross-building ohos-aarch64 applications.
   - ohos-x86_64: For cross-building ohos-x86_64 applications, mainly provided for ohos x86_64 simulator use.
 - api module package stores Cangjie API external declaration files and lto bitcode files.
   - Cangjie API external declaration header files are copied from the api and kit directories of this repository and packaged into the Cangjie SDK.
   - lto bitcode products are under planning and not supported yet.
 - api macro package mainly stores Cangjie macro-related libraries. (For detailed introduction to Cangjie macros, please refer to [Cangjie Macro](https://gitcode.com/Cangjie/cangjie_docs/blob/08234c9e52cd55a6f1a2521c65f39745fa6d64a3/docs/dev-guide/source_en/Macro/macro_introduction.md))
   - ark-interop: Cangjie interoperability macro library of the cangjie_ark_interop component, built by the gn scripts related to the interoperability macro library of the cangjie_ark_interop component.
   - arkui state manager: Cangjie state management macro library of the arkui_cangjie_wrapper component, built by the gn scripts related to the state management macro library of the arkui_cangjie_wrapper component.

**build-tools:**

- Mainly stores Cangjie build toolchain, including Cangjie compiler, standard library, runtime library, tools, etc. The Cangjie build toolchain of the corresponding platform archived during the pre-download stage is copied and packaged into the Cangjie SDK.
  - cangjie-compiler: Includes cjc, cjc-frontend, etc.
  - cangjie-runtime: Mainly includes Cangjie runtime and Cangjie standard library dynamic libraries and Cangjie standard library API external declaration files.
  - cangjie-tools: Mainly includes cjpm, cjdb, cjfmt, etc.

Cangjie SDK package directory structure:
```
cangjie
├── api                                     # API symbol library
│   ├── lib                                 # Cangjie API dynamic libraries and corresponding cjo
│   │   ├── linux_ohos_aarch64_cjnative     
│   │   │   ├── kit
│   │   │   │   ├── xxx.so
│   │   │   │   └── xxx.cjo
│   │   │   └── ohos
│   │   │       ├── xxx.so
│   │   │       └── xxx.cjo
│   │   └── linux_ohos_x86_64_cjnative
│   │       ├── kit
│   │       │   ├── xxx.so
│   │       │   └── xxx.cjo
│   │       └── ohos
│   │           ├── xxx.so
│   │           └── xxx.cjo
│   ├── macro                               # Cangjie API macro libraries and corresponding cjo
│   │   └── ohos
│   │       ├── xxx.dll/xxx.so/xxx.dylib
│   │       └── xxx.cjo
│   └── modules                             # Cangjie API external declaration header files
│       └── linux_ohos_aarch64_cjnative
│           ├── kit
│           │   └── kit.xxx.cj.d
│           └── ohos
│               └── ohos.xxx.cj.d
├── build-tools                             # Cangjie build toolchain
│   ├── bin                                 # Cangjie compiler binary directory
│   ├── lib                                 # Cangjie standard library static library storage directory
│   ├── modules                             # Cangjie standard library header files and cjo storage directory
│   ├── runtime                             # Cangjie runtime dynamic library storage directory (including Cangjie runtime library and Cangjie standard library)                                              
│   ├── third_party                         # Third-party libraries and tools that Cangjie depends on (mingw and llvm tools)
│   └── tools                               # Cangjie tools
└── oh-uni-package.json
```

## Constraints
- The Cangjie package in ohos-sdk supports windows/linux/mac-x64/mac-arm64 platforms, but does not support the ohos platform yet.
- Cangjie API previewer cross-compilation package is not supported yet.
- The Cangjie API module does not support the lto function yet.

## Code Contribution

Developers are welcome to contribute code, documentation, etc. For specific contribution processes and methods, please refer to [Code Contribution](https://gitcode.com/openharmony/docs/blob/master/en/contribute/code-contribution.md).

## Related Repositories

[arkcompiler_cangjie_ark_interop](https://gitcode.com/openharmony-sig/arkcompiler_cangjie_ark_interop/)

[arkui_arkui_cangjie_wrapper](https://gitcode.com/openharmony-sig/arkui_arkui_cangjie_wrapper/)

[third_party_flatbuffers](https://gitcode.com/openharmony/third_party_flatbuffers/)

[interface_sdk_c](https://gitcode.com/openharmony/interface_sdk_c/)

[interface_sdk-js](https://gitcode.com/openharmony/interface_sdk-js/)